# å€ªæµ·å¦å†…å®¹ç½‘ç«™ - æ•°æ®åº“ä¸éƒ¨ç½²æ–¹æ¡ˆ

## ä¸€ã€æ•°æ®åº“æ¶æ„è®¾è®¡

### 1.1 æ•°æ®åº“é€‰å‹ï¼šNeon PostgreSQL

**é€‰æ‹©ç†ç”±ï¼š**
- âœ… **Serverlessæ¶æ„** - æŒ‰éœ€è®¡è´¹ï¼Œè‡ªåŠ¨æ‰©ç¼©å®¹
- âœ… **ä¸Vercelå®Œç¾é›†æˆ** - å®˜æ–¹æ¨èï¼Œé›¶é…ç½®
- âœ… **PostgreSQLå…¼å®¹** - æˆç†Ÿç¨³å®šï¼ŒåŠŸèƒ½å¼ºå¤§
- âœ… **åˆ†æ”¯åŠŸèƒ½** - æ”¯æŒæ•°æ®åº“åˆ†æ”¯ï¼Œä¾¿äºå¼€å‘æµ‹è¯•
- âœ… **å…¨çƒåˆ†å¸ƒ** - ä½å»¶è¿Ÿè®¿é—®
- âœ… **å…è´¹é¢åº¦** - é€‚åˆåˆæœŸä½¿ç”¨

**Neon vs å…¶ä»–æ–¹æ¡ˆï¼š**

| ç‰¹æ€§ | Neon | Supabase | PlanetScale | Railway |
|------|------|----------|-------------|---------|
| æ•°æ®åº“ç±»å‹ | PostgreSQL | PostgreSQL | MySQL | å¤šç§ |
| Serverless | âœ… | âœ… | âœ… | âŒ |
| å…è´¹é¢åº¦ | 0.5GB | 500MB | 5GB | æœ‰é™ |
| Vercelé›†æˆ | ä¼˜ç§€ | è‰¯å¥½ | è‰¯å¥½ | ä¸€èˆ¬ |
| åˆ†æ”¯åŠŸèƒ½ | âœ… | âŒ | âœ… | âŒ |
| ä»·æ ¼ | ä½ | ä¸­ | ä¸­ | é«˜ |

### 1.2 æ•°æ®åº“éœ€æ±‚åˆ†æ

**éœ€è¦æ•°æ®åº“çš„åŠŸèƒ½æ¨¡å—ï¼š**

1. **ç”¨æˆ·è®¤è¯ç³»ç»Ÿ**
   - ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - OAuthç¤¾äº¤ç™»å½•ï¼ˆå¾®ä¿¡ã€Googleç­‰ï¼‰
   - ä¼šè¯ç®¡ç†

2. **è¯„è®ºç³»ç»Ÿ**
   - è¯„è®ºå‘å¸ƒ
   - åµŒå¥—å›å¤
   - ç‚¹èµ/ä¸¾æŠ¥
   - å®¡æ ¸ç®¡ç†

3. **ç”¨æˆ·è¡Œä¸ºè¿½è¸ª**ï¼ˆå¯é€‰ï¼‰
   - é˜…è¯»å†å²
   - æ”¶è—/ä¹¦ç­¾
   - æœç´¢å†å²

**ä¸éœ€è¦æ•°æ®åº“çš„å†…å®¹ï¼š**
- âŒ æ–‡ç« å†…å®¹ â†’ Headless CMSï¼ˆStrapiï¼‰
- âŒ è§†é¢‘ä¿¡æ¯ â†’ YouTube API
- âŒ é™æ€é¡µé¢ â†’ Next.js SSG

### 1.3 æ•°æ®åº“Schemaè®¾è®¡


```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(100) UNIQUE NOT NULL,
  password_hash VARCHAR(255), -- å¦‚æœä½¿ç”¨å¯†ç ç™»å½•
  display_name VARCHAR(100),
  avatar_url TEXT,
  role VARCHAR(20) DEFAULT 'user', -- user, moderator, admin
  oauth_provider VARCHAR(50), -- google, wechat, facebook
  oauth_id VARCHAR(255),
  email_verified BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_login_at TIMESTAMP
);

-- ä¼šè¯è¡¨ï¼ˆå¦‚æœä¸ä½¿ç”¨JWTï¼‰
CREATE TABLE sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  token VARCHAR(255) UNIQUE NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- è¯„è®ºè¡¨
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE SET NULL,
  content_type VARCHAR(50) NOT NULL, -- article, video, classic_book
  content_id VARCHAR(255) NOT NULL, -- CMSä¸­çš„å†…å®¹IDæˆ–slug
  parent_id UUID REFERENCES comments(id) ON DELETE CASCADE, -- åµŒå¥—å›å¤
  content TEXT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending', -- pending, approved, rejected, flagged
  likes_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- ç´¢å¼•ä¼˜åŒ–
  INDEX idx_content (content_type, content_id),
  INDEX idx_user (user_id),
  INDEX idx_parent (parent_id),
  INDEX idx_status (status)
);

-- è¯„è®ºç‚¹èµè¡¨
CREATE TABLE comment_likes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  comment_id UUID REFERENCES comments(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(comment_id, user_id)
);

-- è¯„è®ºä¸¾æŠ¥è¡¨
CREATE TABLE comment_reports (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  comment_id UUID REFERENCES comments(id) ON DELETE CASCADE,
  reporter_id UUID REFERENCES users(id) ON DELETE SET NULL,
  reason VARCHAR(50) NOT NULL, -- spam, offensive, inappropriate
  description TEXT,
  status VARCHAR(20) DEFAULT 'pending', -- pending, reviewed, resolved
  created_at TIMESTAMP DEFAULT NOW(),
  
  INDEX idx_status (status)
);

-- ç”¨æˆ·æ”¶è—è¡¨ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
CREATE TABLE bookmarks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  content_type VARCHAR(50) NOT NULL,
  content_id VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, content_type, content_id)
);

-- é˜…è¯»å†å²è¡¨ï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
CREATE TABLE reading_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  content_type VARCHAR(50) NOT NULL,
  content_id VARCHAR(255) NOT NULL,
  last_read_at TIMESTAMP DEFAULT NOW(),
  
  UNIQUE(user_id, content_type, content_id)
);
```

### 1.4 æ•°æ®åº“ç´¢å¼•ç­–ç•¥

**å…³é”®ç´¢å¼•ï¼š**
```sql
-- è¯„è®ºæŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_comments_content ON comments(content_type, content_id, status);
CREATE INDEX idx_comments_user_created ON comments(user_id, created_at DESC);

-- ç”¨æˆ·æŸ¥è¯¢ä¼˜åŒ–
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_oauth ON users(oauth_provider, oauth_id);

-- å…¨æ–‡æœç´¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
CREATE INDEX idx_comments_content_fts ON comments USING gin(to_tsvector('chinese', content));
```


---

## äºŒã€ORMä¸æ•°æ®åº“è®¿é—®å±‚

### 2.1 ORMé€‰å‹ï¼šPrisma

**é€‰æ‹©ç†ç”±ï¼š**
- âœ… **ç±»å‹å®‰å…¨** - å®Œç¾çš„TypeScriptæ”¯æŒ
- âœ… **å¼€å‘ä½“éªŒ** - ç›´è§‚çš„APIï¼Œè‡ªåŠ¨è¡¥å…¨
- âœ… **è¿ç§»ç®¡ç†** - å†…ç½®æ•°æ®åº“è¿ç§»å·¥å…·
- âœ… **æ€§èƒ½ä¼˜åŒ–** - æŸ¥è¯¢ä¼˜åŒ–ï¼Œè¿æ¥æ± ç®¡ç†
- âœ… **Neonæ”¯æŒ** - å®˜æ–¹æ”¯æŒNeon PostgreSQL

### 2.2 Prisma Schemaå®šä¹‰

```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  username      String    @unique
  passwordHash  String?   @map("password_hash")
  displayName   String?   @map("display_name")
  avatarUrl     String?   @map("avatar_url")
  role          Role      @default(USER)
  oauthProvider String?   @map("oauth_provider")
  oauthId       String?   @map("oauth_id")
  emailVerified Boolean   @default(false) @map("email_verified")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  lastLoginAt   DateTime? @map("last_login_at")

  comments      Comment[]
  commentLikes  CommentLike[]
  reports       CommentReport[]
  bookmarks     Bookmark[]
  readingHistory ReadingHistory[]

  @@map("users")
}

enum Role {
  USER
  MODERATOR
  ADMIN
}

model Comment {
  id          String        @id @default(uuid())
  userId      String?       @map("user_id")
  contentType String        @map("content_type")
  contentId   String        @map("content_id")
  parentId    String?       @map("parent_id")
  content     String
  status      CommentStatus @default(PENDING)
  likesCount  Int           @default(0) @map("likes_count")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  user    User?          @relation(fields: [userId], references: [id], onDelete: SetNull)
  parent  Comment?       @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies Comment[]      @relation("CommentReplies")
  likes   CommentLike[]
  reports CommentReport[]

  @@index([contentType, contentId, status])
  @@index([userId, createdAt])
  @@map("comments")
}

enum CommentStatus {
  PENDING
  APPROVED
  REJECTED
  FLAGGED
}

model CommentLike {
  id        String   @id @default(uuid())
  commentId String   @map("comment_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  comment Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([commentId, userId])
  @@map("comment_likes")
}

model CommentReport {
  id          String       @id @default(uuid())
  commentId   String       @map("comment_id")
  reporterId  String?      @map("reporter_id")
  reason      ReportReason
  description String?
  status      ReportStatus @default(PENDING)
  createdAt   DateTime     @default(now()) @map("created_at")

  comment  Comment @relation(fields: [commentId], references: [id], onDelete: Cascade)
  reporter User?   @relation(fields: [reporterId], references: [id], onDelete: SetNull)

  @@index([status])
  @@map("comment_reports")
}

enum ReportReason {
  SPAM
  OFFENSIVE
  INAPPROPRIATE
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
}

model Bookmark {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  contentType String   @map("content_type")
  contentId   String   @map("content_id")
  createdAt   DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, contentType, contentId])
  @@map("bookmarks")
}

model ReadingHistory {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  contentType String  @map("content_type")
  contentId   String  @map("content_id")
  lastReadAt DateTime @default(now()) @map("last_read_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, contentType, contentId])
  @@map("reading_history")
}
```

### 2.3 æ•°æ®åº“è®¿é—®å±‚å°è£…

```typescript
// lib/db.ts
import { PrismaClient } from '@prisma/client';

const globalForPrisma = global as unknown as { prisma: PrismaClient };

export const prisma =
  globalForPrisma.prisma ||
  new PrismaClient({
    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],
  });

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;

// è¯„è®ºæœåŠ¡ç¤ºä¾‹
export const commentService = {
  // è·å–æ–‡ç« è¯„è®º
  async getComments(contentType: string, contentId: string, page = 1, limit = 20) {
    const skip = (page - 1) * limit;
    
    const [comments, total] = await Promise.all([
      prisma.comment.findMany({
        where: {
          contentType,
          contentId,
          status: 'APPROVED',
          parentId: null, // åªè·å–é¡¶çº§è¯„è®º
        },
        include: {
          user: {
            select: {
              id: true,
              username: true,
              displayName: true,
              avatarUrl: true,
            },
          },
          replies: {
            include: {
              user: {
                select: {
                  id: true,
                  username: true,
                  displayName: true,
                  avatarUrl: true,
                },
              },
            },
            orderBy: { createdAt: 'asc' },
          },
        },
        orderBy: { createdAt: 'desc' },
        skip,
        take: limit,
      }),
      prisma.comment.count({
        where: {
          contentType,
          contentId,
          status: 'APPROVED',
          parentId: null,
        },
      }),
    ]);

    return {
      comments,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit),
      },
    };
  },

  // åˆ›å»ºè¯„è®º
  async createComment(data: {
    userId: string;
    contentType: string;
    contentId: string;
    content: string;
    parentId?: string;
  }) {
    return prisma.comment.create({
      data: {
        ...data,
        status: 'PENDING', // éœ€è¦å®¡æ ¸
      },
      include: {
        user: {
          select: {
            id: true,
            username: true,
            displayName: true,
            avatarUrl: true,
          },
        },
      },
    });
  },

  // ç‚¹èµè¯„è®º
  async likeComment(commentId: string, userId: string) {
    return prisma.$transaction(async (tx) => {
      // åˆ›å»ºç‚¹èµè®°å½•
      await tx.commentLike.create({
        data: { commentId, userId },
      });

      // æ›´æ–°ç‚¹èµæ•°
      return tx.comment.update({
        where: { id: commentId },
        data: { likesCount: { increment: 1 } },
      });
    });
  },
};
```


---

## ä¸‰ã€ç”¨æˆ·è®¤è¯æ–¹æ¡ˆ

### 3.1 è®¤è¯æ–¹æ¡ˆé€‰å‹ï¼šNextAuth.js

**é€‰æ‹©ç†ç”±ï¼š**
- âœ… **Next.jså®˜æ–¹æ¨è** - æ·±åº¦é›†æˆ
- âœ… **å¤šç§è®¤è¯æ–¹å¼** - é‚®ç®±ã€OAuthã€é­”æ³•é“¾æ¥
- âœ… **å®‰å…¨æ€§** - å†…ç½®CSRFä¿æŠ¤ã€ä¼šè¯ç®¡ç†
- âœ… **çµæ´»æ€§** - æ”¯æŒè‡ªå®šä¹‰æ•°æ®åº“é€‚é…å™¨
- âœ… **TypeScriptæ”¯æŒ** - å®Œæ•´ç±»å‹å®šä¹‰

### 3.2 NextAuthé…ç½®

```typescript
// app/api/auth/[...nextauth]/route.ts
import NextAuth, { NextAuthOptions } from 'next-auth';
import GoogleProvider from 'next-auth/providers/google';
import CredentialsProvider from 'next-auth/providers/credentials';
import { PrismaAdapter } from '@auth/prisma-adapter';
import { prisma } from '@/lib/db';
import bcrypt from 'bcryptjs';

export const authOptions: NextAuthOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    // Google OAuth
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    }),
    
    // é‚®ç®±å¯†ç ç™»å½•
    CredentialsProvider({
      name: 'Credentials',
      credentials: {
        email: { label: "Email", type: "email" },
        password: { label: "Password", type: "password" }
      },
      async authorize(credentials) {
        if (!credentials?.email || !credentials?.password) {
          return null;
        }

        const user = await prisma.user.findUnique({
          where: { email: credentials.email }
        });

        if (!user || !user.passwordHash) {
          return null;
        }

        const isValid = await bcrypt.compare(
          credentials.password,
          user.passwordHash
        );

        if (!isValid) {
          return null;
        }

        return {
          id: user.id,
          email: user.email,
          name: user.displayName || user.username,
          image: user.avatarUrl,
        };
      }
    }),
  ],
  
  session: {
    strategy: 'jwt',
    maxAge: 30 * 24 * 60 * 60, // 30 days
  },
  
  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id;
        token.role = user.role;
      }
      return token;
    },
    
    async session({ session, token }) {
      if (session.user) {
        session.user.id = token.id as string;
        session.user.role = token.role as string;
      }
      return session;
    },
  },
  
  pages: {
    signIn: '/auth/signin',
    error: '/auth/error',
  },
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };
```

### 3.3 è®¤è¯ä¸­é—´ä»¶

```typescript
// middleware.ts
import { withAuth } from 'next-auth/middleware';

export default withAuth({
  callbacks: {
    authorized: ({ token, req }) => {
      // ä¿æŠ¤ç®¡ç†å‘˜è·¯ç”±
      if (req.nextUrl.pathname.startsWith('/admin')) {
        return token?.role === 'ADMIN';
      }
      
      // ä¿æŠ¤ç”¨æˆ·è·¯ç”±
      if (req.nextUrl.pathname.startsWith('/profile')) {
        return !!token;
      }
      
      return true;
    },
  },
});

export const config = {
  matcher: ['/admin/:path*', '/profile/:path*'],
};
```


---

## å››ã€Vercel + Neon éƒ¨ç½²æ¶æ„

### 4.1 å®Œæ•´éƒ¨ç½²æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·è¯·æ±‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Vercel Edge Network                        â”‚
â”‚                    (å…¨çƒCDNåˆ†å‘)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Next.js 15 åº”ç”¨                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  SSG Pages   â”‚  â”‚  SSR Pages   â”‚  â”‚  API Routes  â”‚      â”‚
â”‚  â”‚  (é™æ€é¡µé¢)  â”‚  â”‚  (åŠ¨æ€é¡µé¢)  â”‚  â”‚  (åç«¯API)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                          â”‚                          â”‚
                    â–¼                          â–¼                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Neon PostgreSQL â”‚      â”‚  Strapi CMS      â”‚      â”‚  YouTube API     â”‚
         â”‚  (ç”¨æˆ·/è¯„è®ºæ•°æ®) â”‚      â”‚  (å†…å®¹ç®¡ç†)      â”‚      â”‚  (è§†é¢‘æ•°æ®)      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Vercelé¡¹ç›®é…ç½®

**vercel.jsoné…ç½®ï¼š**

```json
{
  "buildCommand": "prisma generate && next build",
  "devCommand": "next dev",
  "installCommand": "pnpm install",
  "framework": "nextjs",
  "regions": ["hkg1", "sfo1", "iad1"],
  "env": {
    "DATABASE_URL": "@database_url",
    "NEXTAUTH_SECRET": "@nextauth_secret",
    "NEXTAUTH_URL": "@nextauth_url",
    "GOOGLE_CLIENT_ID": "@google_client_id",
    "GOOGLE_CLIENT_SECRET": "@google_client_secret",
    "CMS_API_URL": "@cms_api_url",
    "CMS_API_TOKEN": "@cms_api_token"
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    }
  ],
  "rewrites": [
    {
      "source": "/api/cms/:path*",
      "destination": "https://your-cms.com/api/:path*"
    }
  ]
}
```

### 4.3 ç¯å¢ƒå˜é‡é…ç½®

**.env.localï¼ˆæœ¬åœ°å¼€å‘ï¼‰ï¼š**

```bash
# æ•°æ®åº“
DATABASE_URL="postgresql://user:password@localhost:5432/nihaixia_dev"

# NextAuth
NEXTAUTH_SECRET="your-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# OAuth
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# CMS
CMS_API_URL="http://localhost:1337/api"
CMS_API_TOKEN="your-strapi-token"

# å…¶ä»–
NEXT_PUBLIC_SITE_URL="http://localhost:3000"
```

**.env.productionï¼ˆVercelç”Ÿäº§ç¯å¢ƒï¼‰ï¼š**

```bash
# Neonæ•°æ®åº“ï¼ˆä»Vercelé›†æˆè‡ªåŠ¨æ³¨å…¥ï¼‰
DATABASE_URL="postgresql://user:password@ep-xxx.us-east-2.aws.neon.tech/nihaixia_prod?sslmode=require"

# NextAuth
NEXTAUTH_SECRET="production-secret-key"
NEXTAUTH_URL="https://nihaixia.com"

# OAuth
GOOGLE_CLIENT_ID="production-google-client-id"
GOOGLE_CLIENT_SECRET="production-google-client-secret"

# CMS
CMS_API_URL="https://cms.nihaixia.com/api"
CMS_API_TOKEN="production-strapi-token"

# å…¶ä»–
NEXT_PUBLIC_SITE_URL="https://nihaixia.com"
```

### 4.4 Neonæ•°æ®åº“é…ç½®

**1. åˆ›å»ºNeoné¡¹ç›®ï¼š**
```bash
# è®¿é—® https://neon.tech
# åˆ›å»ºæ–°é¡¹ç›®ï¼šnihaixia-website
# é€‰æ‹©åŒºåŸŸï¼šUS East (Ohio) æˆ– Asia Pacific (Singapore)
```

**2. è·å–è¿æ¥å­—ç¬¦ä¸²ï¼š**
```
postgresql://user:password@ep-xxx.region.aws.neon.tech/dbname?sslmode=require
```

**3. åœ¨Vercelä¸­é›†æˆNeonï¼š**
```bash
# æ–¹å¼1ï¼šé€šè¿‡Vercelé›†æˆå¸‚åœº
Vercel Dashboard â†’ Integrations â†’ Neon â†’ Add Integration

# æ–¹å¼2ï¼šæ‰‹åŠ¨æ·»åŠ ç¯å¢ƒå˜é‡
Vercel Dashboard â†’ Project Settings â†’ Environment Variables
æ·»åŠ  DATABASE_URL
```

**4. æ•°æ®åº“åˆ†æ”¯ç­–ç•¥ï¼š**
```
main (ç”Ÿäº§)
  â”œâ”€â”€ staging (é¢„å‘å¸ƒ)
  â””â”€â”€ preview/* (PRé¢„è§ˆåˆ†æ”¯)
```


---

## äº”ã€éƒ¨ç½²æµç¨‹ä¸CI/CD

### 5.1 å®Œæ•´éƒ¨ç½²æµç¨‹

**æ­¥éª¤1ï¼šåˆå§‹åŒ–Neonæ•°æ®åº“**

```bash
# 1. åˆ›å»ºNeoné¡¹ç›®
# è®¿é—® https://console.neon.tech

# 2. å®‰è£…Prisma CLI
pnpm add -D prisma
pnpm add @prisma/client

# 3. åˆå§‹åŒ–Prisma
npx prisma init

# 4. é…ç½®DATABASE_URL
# ç¼–è¾‘ .env æ–‡ä»¶

# 5. åˆ›å»ºæ•°æ®åº“Schema
npx prisma db push

# 6. ç”ŸæˆPrisma Client
npx prisma generate

# 7. å¡«å……åˆå§‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
npx prisma db seed
```

**æ­¥éª¤2ï¼šé…ç½®Vercelé¡¹ç›®**

```bash
# 1. å®‰è£…Vercel CLI
pnpm add -g vercel

# 2. ç™»å½•Vercel
vercel login

# 3. é“¾æ¥é¡¹ç›®
vercel link

# 4. æ·»åŠ ç¯å¢ƒå˜é‡
vercel env add DATABASE_URL production
vercel env add NEXTAUTH_SECRET production
# ... æ·»åŠ å…¶ä»–ç¯å¢ƒå˜é‡

# 5. éƒ¨ç½²
vercel --prod
```

### 5.2 GitHub Actions CI/CDé…ç½®

```yaml
# .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_DB: test_db
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432

    steps:
      - uses: actions/checkout@v3
      
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Generate Prisma Client
        run: npx prisma generate
      
      - name: Run database migrations
        run: npx prisma db push
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db
      
      - name: Type check
        run: pnpm type-check
      
      - name: Lint
        run: pnpm lint
      
      - name: Test
        run: pnpm test
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test_db

  deploy-preview:
    needs: test
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install Vercel CLI
        run: pnpm add -g vercel@latest
      
      - name: Pull Vercel Environment
        run: vercel pull --yes --environment=preview --token=${{ secrets.VERCEL_TOKEN }}
      
      - name: Build Project
        run: vercel build --token=${{ secrets.VERCEL_TOKEN }}
      
      - name: Deploy to Vercel Preview
        id: deploy
        run: |
          url=$(vercel deploy --prebuilt --token=${{ secrets.VERCEL_TOKEN }})
          echo "url=$url" >> $GITHUB_OUTPUT
      
      - name: Comment PR
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `âœ… Preview deployed to: ${{ steps.deploy.outputs.url }}`
            })

  deploy-production:
    needs: test
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install Vercel CLI
        run: pnpm add -g vercel@latest
      
      - name: Pull Vercel Environment
        run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
      
      - name: Build Project
        run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
      
      - name: Deploy to Vercel Production
        run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
```

### 5.3 æ•°æ®åº“è¿ç§»ç­–ç•¥

**å¼€å‘ç¯å¢ƒè¿ç§»ï¼š**

```bash
# ä¿®æ”¹schemaå
npx prisma db push

# æˆ–ä½¿ç”¨è¿ç§»
npx prisma migrate dev --name add_comments_table
```

**ç”Ÿäº§ç¯å¢ƒè¿ç§»ï¼š**

```bash
# 1. åˆ›å»ºè¿ç§»æ–‡ä»¶
npx prisma migrate dev --name production_migration

# 2. åœ¨CI/CDä¸­è‡ªåŠ¨æ‰§è¡Œ
npx prisma migrate deploy

# 3. æˆ–åœ¨Vercel Build Commandä¸­
"buildCommand": "prisma migrate deploy && prisma generate && next build"
```

**Neonåˆ†æ”¯è¿ç§»ï¼š**

```bash
# ä¸ºæ¯ä¸ªPRåˆ›å»ºæ•°æ®åº“åˆ†æ”¯
neon branches create --project-id xxx --name pr-123

# åœ¨PRé¢„è§ˆç¯å¢ƒä½¿ç”¨åˆ†æ”¯æ•°æ®åº“
DATABASE_URL="postgresql://...@pr-123.neon.tech/..."

# PRåˆå¹¶ååˆ é™¤åˆ†æ”¯
neon branches delete --project-id xxx --branch pr-123
```


---

## å…­ã€æ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§

### 6.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

**è¿æ¥æ± é…ç½®ï¼š**

```typescript
// lib/db.ts
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
  // è¿æ¥æ± é…ç½®
  log: ['query', 'error', 'warn'],
});

// Neonæ¨èé…ç½®
// DATABASE_URL="postgresql://...?connection_limit=10&pool_timeout=20"
```

**æŸ¥è¯¢ä¼˜åŒ–ï¼š**

```typescript
// ä½¿ç”¨selectå‡å°‘æ•°æ®ä¼ è¾“
const users = await prisma.user.findMany({
  select: {
    id: true,
    username: true,
    avatarUrl: true,
  },
});

// ä½¿ç”¨includeé¢„åŠ è½½å…³è”æ•°æ®
const comments = await prisma.comment.findMany({
  include: {
    user: true,
    replies: true,
  },
});

// ä½¿ç”¨åˆ†é¡µ
const comments = await prisma.comment.findMany({
  skip: (page - 1) * limit,
  take: limit,
});
```

**ç¼“å­˜ç­–ç•¥ï¼š**

```typescript
// ä½¿ç”¨SWRç¼“å­˜æ•°æ®åº“æŸ¥è¯¢ç»“æœ
import useSWR from 'swr';

function useComments(contentId: string) {
  const { data, error, mutate } = useSWR(
    `/api/comments/${contentId}`,
    fetcher,
    {
      revalidateOnFocus: false,
      revalidateOnReconnect: false,
      dedupingInterval: 60000, // 1åˆ†é’Ÿå†…ä¸é‡å¤è¯·æ±‚
    }
  );

  return {
    comments: data,
    isLoading: !error && !data,
    isError: error,
    mutate,
  };
}
```

### 6.2 ç›‘æ§ä¸å‘Šè­¦

**Vercel Analyticsï¼š**

```typescript
// app/layout.tsx
import { Analytics } from '@vercel/analytics/react';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Analytics />
      </body>
    </html>
  );
}
```

**Prismaç›‘æ§ï¼š**

```typescript
// lib/db.ts
const prisma = new PrismaClient({
  log: [
    {
      emit: 'event',
      level: 'query',
    },
  ],
});

prisma.$on('query', (e) => {
  console.log('Query: ' + e.query);
  console.log('Duration: ' + e.duration + 'ms');
  
  // å‘é€åˆ°ç›‘æ§æœåŠ¡
  if (e.duration > 1000) {
    // æ…¢æŸ¥è¯¢å‘Šè­¦
    console.warn('Slow query detected:', e);
  }
});
```

**Neonç›‘æ§ï¼š**

```bash
# Neon Consoleæä¾›ï¼š
- è¿æ¥æ•°ç›‘æ§
- æŸ¥è¯¢æ€§èƒ½åˆ†æ
- å­˜å‚¨ä½¿ç”¨æƒ…å†µ
- è‡ªåŠ¨å¤‡ä»½çŠ¶æ€
```

---

## ä¸ƒã€å®‰å…¨æœ€ä½³å®è·µ

### 7.1 æ•°æ®åº“å®‰å…¨

**1. è¿æ¥å®‰å…¨ï¼š**
```bash
# å§‹ç»ˆä½¿ç”¨SSLè¿æ¥
DATABASE_URL="postgresql://...?sslmode=require"

# ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸è¦ç¡¬ç¼–ç 
# âŒ é”™è¯¯
const url = "postgresql://user:pass@host/db"

# âœ… æ­£ç¡®
const url = process.env.DATABASE_URL
```

**2. SQLæ³¨å…¥é˜²æŠ¤ï¼š**
```typescript
// âœ… Prismaè‡ªåŠ¨é˜²æŠ¤SQLæ³¨å…¥
const user = await prisma.user.findUnique({
  where: { email: userInput }, // å®‰å…¨
});

// âŒ é¿å…ä½¿ç”¨åŸå§‹SQL
const users = await prisma.$queryRaw`
  SELECT * FROM users WHERE email = ${userInput}
`; // å±é™©ï¼
```

**3. æƒé™æ§åˆ¶ï¼š**
```sql
-- ä¸ºåº”ç”¨åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·
CREATE USER app_user WITH PASSWORD 'secure_password';

-- åªæˆäºˆå¿…è¦æƒé™
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_user;

-- ä¸è¦ä½¿ç”¨è¶…çº§ç”¨æˆ·
```

### 7.2 APIå®‰å…¨

**Rate Limitingï¼š**

```typescript
// lib/rate-limit.ts
import { Ratelimit } from '@upstash/ratelimit';
import { Redis } from '@upstash/redis';

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, '10 s'),
});

export async function checkRateLimit(identifier: string) {
  const { success, limit, reset, remaining } = await ratelimit.limit(identifier);
  
  return {
    success,
    limit,
    reset,
    remaining,
  };
}

// åœ¨API Routeä¸­ä½¿ç”¨
export async function POST(req: Request) {
  const ip = req.headers.get('x-forwarded-for') || 'anonymous';
  const { success } = await checkRateLimit(ip);
  
  if (!success) {
    return new Response('Too many requests', { status: 429 });
  }
  
  // å¤„ç†è¯·æ±‚...
}
```

**è¾“å…¥éªŒè¯ï¼š**

```typescript
// lib/validation.ts
import { z } from 'zod';

export const commentSchema = z.object({
  content: z.string().min(1).max(1000),
  contentType: z.enum(['article', 'video', 'classic_book']),
  contentId: z.string().uuid(),
  parentId: z.string().uuid().optional(),
});

// åœ¨APIä¸­ä½¿ç”¨
export async function POST(req: Request) {
  const body = await req.json();
  
  try {
    const validated = commentSchema.parse(body);
    // ä½¿ç”¨éªŒè¯åçš„æ•°æ®
  } catch (error) {
    return new Response('Invalid input', { status: 400 });
  }
}
```


---

## å…«ã€æˆæœ¬ä¼°ç®—

### 8.1 Neonå®šä»·

| æ–¹æ¡ˆ | å­˜å‚¨ | è®¡ç®— | ä»·æ ¼ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|---------|
| **Free** | 0.5GB | å…±äº« | $0/æœˆ | å¼€å‘æµ‹è¯• |
| **Pro** | 10GB | ä¸“ç”¨ | $19/æœˆ | å°å‹ç”Ÿäº§ |
| **Scale** | 50GB+ | è‡ªåŠ¨æ‰©å±• | $69/æœˆèµ· | ä¸­å¤§å‹ç”Ÿäº§ |

**é¢„ä¼°æˆæœ¬ï¼ˆåˆæœŸï¼‰ï¼š**
- å¼€å‘ç¯å¢ƒï¼šFreeï¼ˆ$0ï¼‰
- ç”Ÿäº§ç¯å¢ƒï¼šProï¼ˆ$19/æœˆï¼‰
- **æ€»è®¡ï¼š$19/æœˆ**

### 8.2 Vercelå®šä»·

| æ–¹æ¡ˆ | å¸¦å®½ | æ„å»ºæ—¶é—´ | ä»·æ ¼ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|------|---------|
| **Hobby** | 100GB | 100å°æ—¶ | $0/æœˆ | ä¸ªäººé¡¹ç›® |
| **Pro** | 1TB | 400å°æ—¶ | $20/æœˆ | å°å›¢é˜Ÿ |
| **Enterprise** | è‡ªå®šä¹‰ | è‡ªå®šä¹‰ | è”ç³»é”€å”® | å¤§å‹ä¼ä¸š |

**é¢„ä¼°æˆæœ¬ï¼ˆåˆæœŸï¼‰ï¼š**
- å¼€å‘é¢„è§ˆï¼šHobbyï¼ˆ$0ï¼‰
- ç”Ÿäº§ç¯å¢ƒï¼šProï¼ˆ$20/æœˆï¼‰
- **æ€»è®¡ï¼š$20/æœˆ**

### 8.3 æ€»æˆæœ¬ä¼°ç®—

**åˆæœŸï¼ˆå‰3ä¸ªæœˆï¼‰ï¼š**
- Neon Pro: $19/æœˆ Ã— 3 = $57
- Vercel Pro: $20/æœˆ Ã— 3 = $60
- åŸŸå: $12/å¹´
- **æ€»è®¡ï¼šçº¦ $129ï¼ˆ3ä¸ªæœˆï¼‰**

**ç¨³å®šæœŸï¼ˆæœˆåº¦ï¼‰ï¼š**
- Neon: $19/æœˆ
- Vercel: $20/æœˆ
- **æ€»è®¡ï¼š$39/æœˆ**

---

## ä¹ã€å¤‡ä»½ä¸ç¾éš¾æ¢å¤

### 9.1 Neonè‡ªåŠ¨å¤‡ä»½

**å¤‡ä»½ç­–ç•¥ï¼š**
```
- è‡ªåŠ¨å¤‡ä»½ï¼šæ¯24å°æ—¶
- ä¿ç•™æœŸé™ï¼š7å¤©ï¼ˆFreeï¼‰/ 30å¤©ï¼ˆProï¼‰
- æ—¶é—´ç‚¹æ¢å¤ï¼šæ”¯æŒï¼ˆProåŠä»¥ä¸Šï¼‰
```

**æ‰‹åŠ¨å¤‡ä»½ï¼š**
```bash
# ä½¿ç”¨pg_dumpå¤‡ä»½
pg_dump $DATABASE_URL > backup_$(date +%Y%m%d).sql

# æ¢å¤å¤‡ä»½
psql $DATABASE_URL < backup_20240101.sql
```

### 9.2 æ•°æ®è¿ç§»è®¡åˆ’

**ä»å…¶ä»–æ•°æ®åº“è¿ç§»åˆ°Neonï¼š**

```bash
# 1. å¯¼å‡ºç°æœ‰æ•°æ®
pg_dump $OLD_DATABASE_URL > migration.sql

# 2. åˆ›å»ºNeonæ•°æ®åº“
# åœ¨Neon Consoleåˆ›å»ºæ–°é¡¹ç›®

# 3. å¯¼å…¥æ•°æ®
psql $NEON_DATABASE_URL < migration.sql

# 4. éªŒè¯æ•°æ®
npx prisma db pull
npx prisma generate
```

---

## åã€æ€»ç»“ä¸å»ºè®®

### 10.1 æ¶æ„ä¼˜åŠ¿

âœ… **Serverlessä¼˜å…ˆ** - Neon + Vercelæ— æœåŠ¡å™¨æ¶æ„ï¼ŒæŒ‰éœ€ä»˜è´¹  
âœ… **å¼€å‘ä½“éªŒ** - Prisma + TypeScriptç±»å‹å®‰å…¨  
âœ… **æ€§èƒ½ä¼˜åŒ–** - å…¨çƒCDN + æ•°æ®åº“è¿æ¥æ±   
âœ… **å®‰å…¨å¯é ** - NextAuth + SSL + è‡ªåŠ¨å¤‡ä»½  
âœ… **æˆæœ¬å¯æ§** - åˆæœŸæœˆæˆæœ¬ä»…$39  

### 10.2 å®æ–½å»ºè®®

**Phase 1: åŸºç¡€è®¾æ–½ï¼ˆWeek 1ï¼‰**
- [ ] åˆ›å»ºNeonæ•°æ®åº“é¡¹ç›®
- [ ] é…ç½®Vercelé¡¹ç›®
- [ ] è®¾ç½®ç¯å¢ƒå˜é‡
- [ ] åˆå§‹åŒ–Prisma

**Phase 2: è®¤è¯ç³»ç»Ÿï¼ˆWeek 2ï¼‰**
- [ ] é…ç½®NextAuth
- [ ] å®ç°ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- [ ] OAuthé›†æˆï¼ˆGoogleï¼‰
- [ ] æƒé™ä¸­é—´ä»¶

**Phase 3: è¯„è®ºç³»ç»Ÿï¼ˆWeek 3ï¼‰**
- [ ] å®ç°è¯„è®ºCRUD API
- [ ] è¯„è®ºå®¡æ ¸åŠŸèƒ½
- [ ] ç‚¹èµ/ä¸¾æŠ¥åŠŸèƒ½
- [ ] å‰ç«¯è¯„è®ºç»„ä»¶

**Phase 4: ä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆWeek 4ï¼‰**
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å®‰å…¨åŠ å›º
- [ ] é›†æˆæµ‹è¯•
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§

### 10.3 å…³é”®å†³ç­–æ€»ç»“

| å†³ç­–ç‚¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| **æ•°æ®åº“** | Neon PostgreSQL | Serverlessã€Vercelé›†æˆã€æˆæœ¬ä½ |
| **ORM** | Prisma | ç±»å‹å®‰å…¨ã€å¼€å‘ä½“éªŒå¥½ |
| **è®¤è¯** | NextAuth.js | Next.jså®˜æ–¹æ¨èã€åŠŸèƒ½å®Œæ•´ |
| **éƒ¨ç½²** | Vercel | é›¶é…ç½®ã€å…¨çƒCDNã€è‡ªåŠ¨æ‰©å±• |
| **CI/CD** | GitHub Actions | å…è´¹ã€çµæ´»ã€ä¸GitHubé›†æˆ |

### 10.4 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… å®Œæˆæ•°æ®åº“ä¸éƒ¨ç½²æ–¹æ¡ˆæ–‡æ¡£
2. ğŸ”„ æ›´æ–°requirements.mdæ·»åŠ æ•°æ®åº“ç›¸å…³éœ€æ±‚
3. ğŸ”„ åˆ›å»ºdesign.mdè¯¦ç»†è®¾è®¡æ–‡æ¡£
4. ğŸ”„ åˆ›å»ºtasks.mdå®æ–½ä»»åŠ¡åˆ—è¡¨
5. ğŸ”„ åˆå§‹åŒ–é¡¹ç›®å¹¶é…ç½®Neon + Vercel

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2024-11-07  
**æœ€åæ›´æ–°ï¼š** 2024-11-07  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ
