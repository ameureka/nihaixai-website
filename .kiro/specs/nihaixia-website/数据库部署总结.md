# æ•°æ®åº“ä¸éƒ¨ç½²æ–¹æ¡ˆ - æ‰§è¡Œæ€»ç»“

## ğŸ¯ æ ¸å¿ƒå†³ç­–

### æ•°æ®åº“ï¼šNeon PostgreSQL âœ…

**ä¸ºä»€ä¹ˆé€‰æ‹©Neonï¼Ÿ**
- âœ… Serverlessæ¶æ„ï¼ŒæŒ‰éœ€ä»˜è´¹
- âœ… ä¸Vercelå®Œç¾é›†æˆ
- âœ… æ”¯æŒæ•°æ®åº“åˆ†æ”¯ï¼ˆå¼€å‘/é¢„è§ˆ/ç”Ÿäº§ï¼‰
- âœ… è‡ªåŠ¨å¤‡ä»½å’Œæ—¶é—´ç‚¹æ¢å¤
- âœ… åˆæœŸæˆæœ¬ä½ï¼ˆ$19/æœˆï¼‰

### éƒ¨ç½²ï¼šVercel âœ…

**ä¸ºä»€ä¹ˆé€‰æ‹©Vercelï¼Ÿ**
- âœ… Next.jså®˜æ–¹å¹³å°ï¼Œé›¶é…ç½®
- âœ… å…¨çƒCDNï¼Œè‡ªåŠ¨æ‰©å±•
- âœ… é¢„è§ˆéƒ¨ç½²ï¼ˆæ¯ä¸ªPRï¼‰
- âœ… ç¯å¢ƒå˜é‡ç®¡ç†
- âœ… åˆæœŸæˆæœ¬ä½ï¼ˆ$20/æœˆï¼‰

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®è¡¨

```
users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ id, email, username
â”œâ”€â”€ password_hash (åŠ å¯†å¯†ç )
â”œâ”€â”€ oauth_provider, oauth_id (ç¤¾äº¤ç™»å½•)
â””â”€â”€ role (USER/MODERATOR/ADMIN)

comments (è¯„è®ºè¡¨)
â”œâ”€â”€ id, user_id, content
â”œâ”€â”€ content_type, content_id (å…³è”å†…å®¹)
â”œâ”€â”€ parent_id (åµŒå¥—å›å¤)
â””â”€â”€ status (PENDING/APPROVED/REJECTED)

comment_likes (ç‚¹èµè¡¨)
comment_reports (ä¸¾æŠ¥è¡¨)
bookmarks (æ”¶è—è¡¨) - å¯é€‰
reading_history (é˜…è¯»å†å²) - å¯é€‰
```

### æŠ€æœ¯æ ˆ

- **ORM**: Prismaï¼ˆç±»å‹å®‰å…¨ï¼‰
- **è®¤è¯**: NextAuth.jsï¼ˆOAuth + å¯†ç ï¼‰
- **éªŒè¯**: Zodï¼ˆè¾“å…¥éªŒè¯ï¼‰
- **é™æµ**: Upstash Rate Limit

---

## ğŸš€ éƒ¨ç½²æ¶æ„

```
ç”¨æˆ·è¯·æ±‚
    â†“
Vercel Edge Network (å…¨çƒCDN)
    â†“
Next.js 15 åº”ç”¨
    â”œâ”€â”€ SSG Pages (é™æ€é¡µé¢)
    â”œâ”€â”€ SSR Pages (åŠ¨æ€é¡µé¢)
    â””â”€â”€ API Routes (åç«¯API)
         â”œâ”€â”€ Neon PostgreSQL (ç”¨æˆ·/è¯„è®º)
         â”œâ”€â”€ Strapi CMS (æ–‡ç« å†…å®¹)
         â””â”€â”€ YouTube API (è§†é¢‘æ•°æ®)
```

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### åˆæœŸï¼ˆå‰3ä¸ªæœˆï¼‰

| æœåŠ¡ | æ–¹æ¡ˆ | æœˆè´¹ | 3ä¸ªæœˆ |
|------|------|------|-------|
| Neon | Pro | $19 | $57 |
| Vercel | Pro | $20 | $60 |
| åŸŸå | - | - | $12 |
| **æ€»è®¡** | - | **$39/æœˆ** | **$129** |

### æ‰©å±•åï¼ˆé¢„ä¼°ï¼‰

- æœˆæ´»1ä¸‡ç”¨æˆ·ï¼š$39/æœˆ
- æœˆæ´»10ä¸‡ç”¨æˆ·ï¼š$100-200/æœˆ
- æœˆæ´»100ä¸‡ç”¨æˆ·ï¼š$500-1000/æœˆ

---

## ğŸ“ å®æ–½æ­¥éª¤

### Week 1: åŸºç¡€è®¾æ–½

```bash
# 1. åˆ›å»ºNeoné¡¹ç›®
è®¿é—® https://console.neon.tech
åˆ›å»ºé¡¹ç›®ï¼šnihaixia-website
åŒºåŸŸï¼šUS East (Ohio) æˆ– Asia Pacific (Singapore)

# 2. é…ç½®Vercel
vercel login
vercel link
vercel env add DATABASE_URL production

# 3. åˆå§‹åŒ–Prisma
pnpm add prisma @prisma/client
npx prisma init
npx prisma db push
npx prisma generate
```

### Week 2: è®¤è¯ç³»ç»Ÿ

```bash
# 1. å®‰è£…NextAuth
pnpm add next-auth @auth/prisma-adapter

# 2. é…ç½®OAuth
# Google Consoleåˆ›å»ºOAuthåº”ç”¨
# æ·»åŠ ç¯å¢ƒå˜é‡

# 3. å®ç°ç™»å½•é¡µé¢
# /app/auth/signin/page.tsx
```

### Week 3: è¯„è®ºç³»ç»Ÿ

```bash
# 1. åˆ›å»ºAPI Routes
# /app/api/comments/route.ts
# /app/api/comments/[id]/route.ts

# 2. å®ç°å‰ç«¯ç»„ä»¶
# /components/CommentSection.tsx
# /components/CommentForm.tsx

# 3. æ·»åŠ å®¡æ ¸åŠŸèƒ½
# /app/admin/comments/page.tsx
```

### Week 4: æµ‹è¯•ä¸éƒ¨ç½²

```bash
# 1. é›†æˆæµ‹è¯•
pnpm test

# 2. æ€§èƒ½æµ‹è¯•
npx lighthouse https://preview-url

# 3. éƒ¨ç½²ç”Ÿäº§
git push origin main
```

---

## ğŸ”’ å®‰å…¨æ¸…å•

- [x] ä½¿ç”¨SSLè¿æ¥æ•°æ®åº“ï¼ˆsslmode=requireï¼‰
- [x] å¯†ç ä½¿ç”¨bcryptåŠ å¯†
- [x] JWTä¼šè¯ç®¡ç†
- [x] API Rate Limiting
- [x] è¾“å…¥éªŒè¯ï¼ˆZodï¼‰
- [x] SQLæ³¨å…¥é˜²æŠ¤ï¼ˆPrismaï¼‰
- [x] CSRFä¿æŠ¤ï¼ˆNextAuthå†…ç½®ï¼‰
- [x] å®‰å…¨å“åº”å¤´é…ç½®

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### æ•°æ®åº“

- è¿æ¥æ•°ï¼š< 10ï¼ˆè¿æ¥æ± é™åˆ¶ï¼‰
- æŸ¥è¯¢æ—¶é—´ï¼š< 100msï¼ˆå¹³å‡ï¼‰
- æ…¢æŸ¥è¯¢ï¼š> 1sï¼ˆå‘Šè­¦ï¼‰
- å­˜å‚¨ä½¿ç”¨ï¼š< 80%ï¼ˆå‘Šè­¦ï¼‰

### API

- å“åº”æ—¶é—´ï¼š< 200msï¼ˆP95ï¼‰
- é”™è¯¯ç‡ï¼š< 1%
- è¯·æ±‚é™æµï¼š10æ¬¡/10ç§’
- æˆåŠŸç‡ï¼š> 99%

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œå’Œç™»å½•
- [ ] ç”¨æˆ·å¯ä»¥å‘è¡¨è¯„è®º
- [ ] ç”¨æˆ·å¯ä»¥å›å¤è¯„è®º
- [ ] ç”¨æˆ·å¯ä»¥ç‚¹èµè¯„è®º
- [ ] ç®¡ç†å‘˜å¯ä»¥å®¡æ ¸è¯„è®º
- [ ] è¯„è®ºæ”¯æŒåˆ†é¡µåŠ è½½

### æ€§èƒ½éªŒæ”¶

- [ ] è¯„è®ºåŠ è½½æ—¶é—´ < 500ms
- [ ] æ•°æ®åº“æŸ¥è¯¢ < 100ms
- [ ] APIå“åº”æ—¶é—´ < 200ms
- [ ] å¹¶å‘æ”¯æŒ > 100ç”¨æˆ·

### å®‰å…¨éªŒæ”¶

- [ ] é€šè¿‡OWASPå®‰å…¨æµ‹è¯•
- [ ] å¯†ç åŠ å¯†å­˜å‚¨
- [ ] APIé™æµç”Ÿæ•ˆ
- [ ] è¾“å…¥éªŒè¯å®Œæ•´

---

## ğŸ“ å…³é”®å­¦ä¹ èµ„æº

**Neonæ–‡æ¡£ï¼š**
- https://neon.tech/docs/introduction
- https://neon.tech/docs/guides/vercel

**Prismaæ–‡æ¡£ï¼š**
- https://www.prisma.io/docs/getting-started
- https://www.prisma.io/docs/concepts/components/prisma-client

**NextAuthæ–‡æ¡£ï¼š**
- https://next-auth.js.org/getting-started/introduction
- https://next-auth.js.org/adapters/prisma

**Vercelæ–‡æ¡£ï¼š**
- https://vercel.com/docs/deployments/overview
- https://vercel.com/docs/storage/vercel-postgres

---

## ğŸ“ æ”¯æŒä¸å¸®åŠ©

**é‡åˆ°é—®é¢˜ï¼Ÿ**
1. æŸ¥çœ‹Neon Consoleæ—¥å¿—
2. æŸ¥çœ‹Verceléƒ¨ç½²æ—¥å¿—
3. æ£€æŸ¥Prisma Studioæ•°æ®
4. æŸ¥çœ‹GitHub Actionsæ—¥å¿—

**å¸¸è§é—®é¢˜ï¼š**
- æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥DATABASE_URL
- è®¤è¯ä¸å·¥ä½œ â†’ æ£€æŸ¥NEXTAUTH_SECRET
- éƒ¨ç½²å¤±è´¥ â†’ æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- æ€§èƒ½æ…¢ â†’ æ£€æŸ¥æ•°æ®åº“ç´¢å¼•

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥ï¼š** åˆ›å»ºdesign.mdå’Œtasks.md
